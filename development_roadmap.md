# メイクミー勤怠システム 開発ロードマップ

## 📋 プロジェクト概要
- **目的**: 既存勤怠システムのDB設計改善とエンタープライズ機能追加
- **開始日**: 2025年1月31日
- **主要課題**: 拠点管理ハードコード、承認機能欠如、権限管理不備

## 🔥 優先度高 - 即座対応必要（目標：1週間以内）

### ✅ 1. 拠点マスターテーブル作成
- **期限**: 2025年2月3日
- **担当**: システム開発者
- **状態**: ✅ 完了
- **概要**: ハードコードされた場所選択（本社/支社/在宅）をマスターテーブル化
- **成果物**:
  - [x] `locations`テーブル作成
  - [x] 初期データ投入（本社/支社/在宅）
  - [x] `time_records`テーブルに`location_id`追加
  - [x] 既存データのマイグレーション
- **影響範囲**:
  - `src/App.tsx` - 場所選択の動的化 ✅
  - `src/services/timeRecordService.ts` - location_id対応 ✅
  - `src/services/locationService.ts` - 拠点管理サービス作成済み ✅
- **完了日**: 2025年1月31日
- **マイグレーション結果**: 本社32件、在宅4件のデータ移行完了

### ⏳ 2. 計算項目のビュー化
- **期限**: 2025年2月5日
- **担当**: システム開発者
- **状態**: ⚪ 未着手
- **概要**: daily_reportsの計算項目を動的生成に変更
- **成果物**:
  - [ ] `daily_reports_with_metrics`ビュー作成
  - [ ] 計算カラム削除（段階的実施）
  - [ ] サービス層の修正
- **影響範囲**:
  - `src/services/dailyReportService.ts` - ビュー対応
  - `src/components/SalesChart.tsx` - データ取得修正
  - `src/components/AttendanceCalendar.tsx` - 指標表示修正
- **リスク**: データ不整合、パフォーマンス影響

### ⏳ 3. 位置情報設計改善
- **期限**: 2025年2月7日
- **担当**: システム開発者
- **状態**: ⚪ 未着手
- **概要**: 未使用の位置情報カラム整理と正規化
- **成果物**:
  - [ ] 不要カラム削除（location_lat, location_lng）
  - [ ] location_name → location_id 正規化
  - [ ] LocationService整理
- **影響範囲**:
  - `src/services/locationService.ts` - 削除または簡素化
  - `src/types/supabase.ts` - 型定義更新
- **リスク**: 位置情報機能完全削除の妥当性確認

## 🟡 優先度中 - 運用改善（目標：2-4週間）

### ⏳ 4. 承認ワークフロー実装
- **期限**: 2025年2月21日
- **担当**: システム開発者
- **状態**: ⚪ 未着手
- **概要**: 勤怠記録・日報の承認機能追加
- **成果物**:
  - [ ] `approvals`テーブル作成
  - [ ] 承認フロー UI実装
  - [ ] 承認者権限管理
  - [ ] 通知機能連携
- **影響範囲**:
  - 新規コンポーネント作成
  - 既存編集機能に承認処理追加
- **リスク**: 既存ワークフローへの影響

### ⏳ 5. ユーザー権限管理
- **期限**: 2025年2月28日
- **担当**: システム開発者
- **状態**: ⚪ 未着手
- **概要**: ロールベースアクセス制御（RBAC）実装
- **成果物**:
  - [ ] `roles`, `user_roles`テーブル作成
  - [ ] 基本ロール設定（社員/管理者/システム管理者）
  - [ ] 権限チェック機能実装
  - [ ] UI表示制御
- **影響範囲**:
  - 全コンポーネントの権限チェック追加
  - 認証システム拡張
- **リスク**: セキュリティ要件の複雑化

### ⏳ 6. 通知システム
- **期限**: 2025年3月7日
- **担当**: システム開発者
- **状態**: ⚪ 未着手
- **概要**: アプリ内通知機能実装
- **成果物**:
  - [ ] `notifications`テーブル作成
  - [ ] 通知表示UI実装
  - [ ] リアルタイム通知配信
  - [ ] 通知履歴管理
- **影響範囲**:
  - ヘッダー部分に通知アイコン追加
  - 通知一覧ページ作成
- **リスク**: リアルタイム配信の技術的複雑性

## 🔵 優先度低 - 将来拡張（目標：3ヶ月以内）

### ⏳ 7. 休暇管理システム
- **期限**: 2025年4月30日
- **担当**: システム開発者
- **状態**: ⚪ 未着手
- **概要**: 有給休暇申請・承認機能
- **成果物**:
  - [ ] `leave_types`, `leave_requests`テーブル作成
  - [ ] 休暇申請UI実装
  - [ ] 残日数管理機能
- **影響範囲**: 新規機能追加
- **リスク**: 法的要件への対応必要性

### ⏳ 8. 部署・プロジェクト管理
- **期限**: 2025年5月31日
- **担当**: システム開発者
- **状態**: ⚪ 未着手
- **概要**: 組織階層とプロジェクト管理
- **成果物**:
  - [ ] `departments`, `projects`テーブル作成
  - [ ] 組織図表示機能
  - [ ] プロジェクト別勤怠集計
- **影響範囲**: 統計・レポート機能拡張
- **リスク**: 既存データ構造への影響

## 📊 進捗管理

### 全体進捗
- **完了**: 1/8項目 (12.5%)
- **進行中**: 0/8項目 (0%)
- **未着手**: 7/8項目 (87.5%)

### 優先度別進捗
| 優先度 | 完了 | 進行中 | 未着手 | 進捗率 |
|--------|------|--------|--------|--------|
| 高 | 1/3 | 0/3 | 2/3 | 33% |
| 中 | 0/3 | 0/3 | 3/3 | 0% |
| 低 | 0/2 | 0/2 | 2/2 | 0% |

### 今週の重点項目
1. **拠点マスターテーブル作成** - DB設計・実装・テストまで完了
2. **計算項目ビュー化** - 設計検討・実装準備

### 次週の予定項目
1. **計算項目ビュー化** - 実装・テスト
2. **位置情報設計改善** - 設計・実装

## 🔧 技術的考慮事項

### データベース
- **バックアップ**: 各変更前に必須
- **マイグレーション**: 段階的実施でダウンタイム最小化
- **インデックス**: パフォーマンス劣化防止

### フロントエンド
- **型安全性**: TypeScript型定義の随時更新
- **リアルタイム更新**: 既存システムとの整合性確保
- **UI/UX**: 既存操作性を損なわない改善

### セキュリティ
- **RLS**: Row Level Security適切な設定
- **権限管理**: 最小権限の原則遵守
- **監査ログ**: 重要操作の記録

## 📝 変更履歴
- **2025-01-31**: 初版作成、分析結果を基に8項目策定
- **2025-01-31**: 優先度高の項目1「拠点マスターテーブル作成」着手
- **2025-01-31**: 優先度高の項目1「拠点マスターテーブル作成」完了
  - locationsテーブル作成・初期データ投入完了
  - time_recordsにlocation_id追加・既存データ移行完了（本社32件、在宅4件）
  - App.tsx・TimeRecordServiceの動的拠点選択実装完了

## 📞 連絡事項
- **週次レビュー**: 毎週金曜日 進捗確認・課題共有
- **緊急時**: 重大な問題発生時は即座に対応方針協議
- **仕様変更**: 要件変更時はロードマップ更新